<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø­Ø¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ - Ù„ÙŠØ§Ù„ÙŠ Ø±Ù…Ø¶Ø§Ù†</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â˜ª</text></svg>">
</head>
<body>
    <!-- Floating Lanterns Decoration -->
    <div class="lanterns-container" aria-hidden="true">
        <div class="lantern lantern-1"></div>
        <div class="lantern lantern-2"></div>
        <div class="lantern lantern-3"></div>
    </div>

    <!-- Mosque Silhouette at Bottom -->
    <div class="mosque-silhouette" aria-hidden="true"></div>

    <div class="container">
        <header class="ornate-border">
            <div class="header-decoration">
                <span class="crescent-icon">â˜ª</span>
            </div>
            <h1 class="title" data-i18n="header.title"></h1>
            <p class="header-subtitle" data-i18n="header.subtitle"></p>
            <div class="role-indicator" id="roleIndicator"></div>
        </header>

        <div class="content-box ornate-border">
            <!-- Decorative Corner Elements -->
            <div class="corner-decoration top-right" aria-hidden="true"></div>
            <div class="corner-decoration top-left" aria-hidden="true"></div>
            <div class="corner-decoration bottom-right" aria-hidden="true"></div>
            <div class="corner-decoration bottom-left" aria-hidden="true"></div>

            <!-- Landing Page (No Session) - Participant Only -->
            <section class="landing-section" id="landingSection">
                <div class="section-icon">
                    <span class="icon-star">âœ¦</span>
                </div>
                <h2 data-i18n="landing.welcome"></h2>
                <p class="landing-subtitle" data-i18n="landing.subtitle"></p>
                <div class="landing-form">
                    <div class="name-inputs">
                        <div class="input-wrapper">
                            <label for="firstName" data-i18n="landing.firstName"></label>
                            <input type="text" id="firstName" data-i18n-placeholder="landing.firstNamePlaceholder" placeholder="" class="vintage-input">
                        </div>
                        <div class="input-wrapper">
                            <label for="middleName" data-i18n="landing.middleName"></label>
                            <input type="text" id="middleName" data-i18n-placeholder="landing.middleNamePlaceholder" placeholder="" class="vintage-input">
                        </div>
                    </div>
                    <button onclick="joinFromLanding()" class="vintage-button primary full-width" data-i18n="landing.joinNow">
                        <span class="btn-icon">â˜ª</span>
                    </button>
                </div>
            </section>

            <!-- Admin Login -->
            <section class="admin-login-section" id="adminLoginSection" style="display: none;">
                <div class="lang-toggle">
                    <button onclick="toggleAdminLanguage()" class="vintage-button small" id="langToggleBtn">English</button>
                </div>
                <div class="section-icon">
                    <span class="icon-crescent">â˜ª</span>
                </div>
                <h2 data-i18n="admin.login"></h2>
                <p class="section-description" data-i18n="admin.enterPassword"></p>
                <div class="form-container">
                    <div class="input-group">
                        <input type="password" id="adminPassword" data-i18n-placeholder="admin.password" placeholder="" class="vintage-input">
                    </div>
                    <button onclick="adminLogin()" class="vintage-button primary full-width" data-i18n="admin.loginButton"></button>
                    <div id="adminSetupPrompt" class="setup-prompt" style="display: none;">
                        <div class="prompt-header">
                            <span class="prompt-icon">âœ¦</span>
                            <p data-i18n="admin.setupPassword"></p>
                        </div>
                        <div class="input-group">
                            <input type="password" id="newAdminPassword" data-i18n-placeholder="admin.newPassword" placeholder="" class="vintage-input">
                        </div>
                        <div class="input-group">
                            <input type="password" id="confirmAdminPassword" data-i18n-placeholder="admin.confirmPassword" placeholder="" class="vintage-input">
                        </div>
                        <button onclick="setupAdminPassword()" class="vintage-button primary full-width" data-i18n="admin.createPassword"></button>
                    </div>
                </div>
            </section>

            <!-- Admin Dashboard (Session List) -->
            <section class="admin-dashboard-section" id="adminDashboardSection" style="display: none;">
                <div class="admin-header">
                    <div class="header-title-group">
                        <div class="section-icon small">
                            <span class="icon-crescent">â˜ª</span>
                        </div>
                        <h2 data-i18n="admin.dashboard"></h2>
                    </div>
                    <div class="admin-header-buttons">
                        <button onclick="toggleAdminLanguage()" class="vintage-button small" id="langToggleBtnDash">English</button>
                        <button onclick="adminLogout()" class="vintage-button secondary small" data-i18n="admin.logout"></button>
                    </div>
                </div>
                <p class="section-description" data-i18n="admin.manageSessions"></p>

                <!-- Create New Session Button -->
                <button onclick="showCreateSession()" class="vintage-button primary create-session-btn" data-i18n="admin.createNewSession">
                    <span class="btn-icon">âœ¦</span>
                </button>

                <!-- Sessions List -->
                <div class="sessions-list-container">
                    <div class="section-divider">
                        <span class="divider-text" data-i18n="admin.previousSessions"></span>
                    </div>
                    <div id="sessionsListContainer">
                        <div class="empty-message" data-i18n="admin.loading"></div>
                    </div>
                </div>

                <!-- Change Password Section -->
                <div class="change-password-section">
                    <div class="section-divider">
                        <span class="divider-text" data-i18n="admin.changePassword"></span>
                    </div>
                    <div class="input-group">
                        <input type="password" id="currentPassword" data-i18n-placeholder="admin.currentPassword" placeholder="" class="vintage-input">
                    </div>
                    <div class="input-group">
                        <input type="password" id="newPasswordChange" data-i18n-placeholder="admin.newPassword" placeholder="" class="vintage-input">
                    </div>
                    <div class="input-group">
                        <input type="password" id="confirmPasswordChange" data-i18n-placeholder="admin.confirmPassword" placeholder="" class="vintage-input">
                    </div>
                    <button onclick="changeAdminPassword()" class="vintage-button primary" data-i18n="admin.changePasswordBtn"></button>
                </div>
            </section>

            <!-- Create Session Modal -->
            <section class="create-session-section" id="createSessionSection" style="display: none;">
                <div class="section-icon">
                    <span class="icon-star">âœ¦</span>
                </div>
                <h2 data-i18n="createSession.title"></h2>
                <div class="form-container">
                    <div class="input-group">
                        <label data-i18n="createSession.sessionName"></label>
                        <input type="text" id="sessionName" data-i18n-placeholder="createSession.sessionNamePlaceholder" placeholder="" class="vintage-input">
                    </div>
                    <div class="input-group">
                        <label data-i18n="createSession.yourName"></label>
                        <input type="text" id="organizerName" data-i18n-placeholder="createSession.yourName" placeholder="" class="vintage-input">
                    </div>
                    <div class="input-group">
                        <label data-i18n="createSession.eventDate"></label>
                        <input type="date" id="eventDate" class="vintage-input">
                    </div>
                    <div class="action-buttons">
                        <button onclick="createSession()" class="vintage-button primary" data-i18n="createSession.create">
                            <span class="btn-icon">â˜ª</span>
                        </button>
                        <button onclick="backToAdminDashboard()" class="vintage-button secondary" data-i18n="createSession.cancel"></button>
                    </div>
                </div>
            </section>

            <!-- Organizer View -->
            <section class="organizer-section" id="organizerSection" style="display: none;">
                <div class="section-header">
                    <div class="header-title-group">
                        <div class="section-icon small">
                            <span class="icon-crescent">â˜ª</span>
                        </div>
                        <h2 data-i18n="organizer.controlPanel"></h2>
                    </div>
                    <div class="section-header-buttons">
                        <button onclick="toggleAdminLanguage()" class="vintage-button small" id="langToggleBtnOrg">English</button>
                        <button onclick="backToAdminDashboard()" class="vintage-button secondary back-btn" data-i18n="organizer.allSessions"></button>
                    </div>
                </div>

                <!-- Session Info Card -->
                <div class="session-info-card">
                    <div class="card-header">
                        <h3 id="sessionTitle"></h3>
                        <div class="card-decoration">âœ¦</div>
                    </div>

                    <!-- Countdown Display -->
                    <div class="countdown-display" id="countdownDisplay" style="display: none;">
                        <div class="countdown-content">
                            <span class="countdown-number" id="countdownDays">0</span>
                            <span class="countdown-label" id="countdownLabel" data-i18n="countdown.daysRemaining"></span>
                        </div>
                        <button onclick="editEventDate()" class="vintage-button small" id="editDateBtn" data-i18n="countdown.editDate"></button>
                    </div>

                    <!-- Set Date Button (shown when no date set) -->
                    <button onclick="editEventDate()" class="vintage-button small set-date-btn" id="setDateBtn" style="display: none;" data-i18n="countdown.setEventDate"></button>

                    <!-- Share Link Section -->
                    <div class="session-link-box">
                        <label data-i18n="organizer.shareLink"></label>
                        <div class="link-display">
                            <input type="text" id="sessionLink" readonly class="link-input">
                            <button onclick="copySessionLink()" class="vintage-button" data-i18n="organizer.copy"></button>
                        </div>
                        <div class="share-buttons">
                            <button onclick="shareWhatsApp()" class="vintage-button share-btn whatsapp">
                                <span class="share-icon">ðŸ’¬</span>
                                WhatsApp
                            </button>
                            <button onclick="shareTelegram()" class="vintage-button share-btn telegram">
                                <span class="share-icon">âœˆ</span>
                                Telegram
                            </button>
                        </div>
                    </div>

                    <!-- Registration Toggle -->
                    <div class="registration-toggle">
                        <button onclick="toggleRegistration()" class="vintage-button" id="registrationToggleBtn" data-i18n="organizer.closeRegistration"></button>
                        <span class="registration-status" id="registrationStatus" data-i18n="organizer.registrationOpen"></span>
                    </div>
                </div>

                <!-- Participants Management Card -->
                <div class="management-card">
                    <div class="card-header">
                        <h3><span data-i18n="organizer.participants"></span> (<span id="participantCount">0</span>)</h3>
                        <div class="card-decoration">âœ¦</div>
                    </div>

                    <!-- Add Participant Manually -->
                    <div class="add-participant-manual">
                        <input type="text" id="manualParticipantName" data-i18n-placeholder="organizer.addManually" placeholder="" class="vintage-input">
                        <button onclick="addParticipantManually()" class="vintage-button" data-i18n="organizer.add"></button>
                    </div>
                    <ul id="organizerParticipantsList" class="participants-list"></ul>
                </div>

                <!-- Restrictions Card -->
                <div class="management-card restrictions-card">
                    <div class="card-header">
                        <h3 data-i18n="organizer.restrictionsOptional"></h3>
                        <div class="card-decoration">â˜ª</div>
                    </div>
                    <p class="help-text" data-i18n="organizer.restrictionsHelp"></p>
                    <div id="restrictionsContainer"></div>
                </div>

                <!-- Draw Controls Card -->
                <div class="draw-controls-card">
                    <div class="draw-progress">
                        <span id="organizerProgressText">0 Ù…Ù† 0 Ø³Ø­Ø¨ÙˆØ§</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="organizerProgressFill"></div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button onclick="startDrawAsOrganizer()" class="vintage-button primary large" id="startDrawBtn" data-i18n="organizer.startDraw">
                            <span class="btn-icon">â˜ª</span>
                        </button>
                        <button onclick="resetSession()" class="vintage-button secondary" data-i18n="organizer.reset"></button>
                    </div>
                </div>

                <!-- View All Assignments (Hidden by default) -->
                <div class="view-results-section" id="viewResultsSection" style="display: none;">
                    <div class="section-divider">
                        <span class="divider-text" data-i18n="organizer.viewResults"></span>
                    </div>
                    <div class="results-buttons">
                        <button onclick="showAllAssignments()" class="vintage-button" id="showResultsBtn" data-i18n="organizer.showAllResults"></button>
                    </div>
                    <!-- Individual Results (each hidden by default) -->
                    <div class="individual-assignments-wrapper">
                        <div class="individual-assignments" id="individualAssignmentsContainer"></div>
                    </div>
                    <!-- All Results View -->
                    <div class="all-assignments" id="allAssignmentsContainer" style="display: none;">
                        <div class="assignments-list-wrapper">
                            <div id="assignmentsList"></div>
                        </div>
                        <button onclick="hideAllAssignments()" class="vintage-button secondary" data-i18n="organizer.hideResults"></button>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="danger-zone">
                    <div class="section-divider danger">
                        <span class="divider-text" data-i18n="organizer.dangerZone"></span>
                    </div>
                    <button onclick="deleteSession()" class="vintage-button danger" data-i18n="organizer.deleteSession"></button>
                </div>
            </section>

            <!-- Participant View -->
            <section class="participant-section" id="participantSection" style="display: none;">
                <!-- Welcome Header -->
                <div class="participant-welcome">
                    <div class="welcome-decoration">
                        <span class="deco-star left">âœ¦</span>
                        <span class="deco-crescent">â˜ª</span>
                        <span class="deco-star right">âœ¦</span>
                    </div>
                    <span class="welcome-label" data-i18n="participant.welcome"></span>
                    <span class="participant-name-large" id="participantNameLabel"></span>
                </div>

                <!-- Countdown Display for Participant -->
                <div class="countdown-display participant-countdown" id="participantCountdown" style="display: none;">
                    <div class="countdown-decoration">
                        <span class="countdown-star">âœ¦</span>
                    </div>
                    <div class="countdown-content">
                        <span class="countdown-number" id="participantCountdownDays">0</span>
                        <span class="countdown-label" id="participantCountdownLabel" data-i18n="countdown.daysRemaining"></span>
                    </div>
                </div>

                <!-- Rules Section -->
                <div class="rules-card">
                    <div class="rules-header">
                        <span class="rules-icon">âœ¦</span>
                        <h4 data-i18n="participant.rulesTitle"></h4>
                    </div>
                    <div class="rules-content" data-i18n="participant.rulesContent"></div>
                </div>

                <!-- Status Card -->
                <div class="participant-status-card">
                    <!-- Waiting State -->
                    <div class="waiting-state" id="waitingState">
                        <div class="status-icon waiting-icon">
                            <div class="pulse-ring"></div>
                            <div class="pulse-ring delay"></div>
                            <span class="icon-inner">â˜ª</span>
                        </div>
                        <h3 data-i18n="participant.waiting"></h3>
                        <p id="waitingMessage" data-i18n="participant.waitingMessage"></p>
                    </div>

                    <!-- Excluded State -->
                    <div class="excluded-state" id="excludedState" style="display: none;">
                        <div class="status-icon waiting-icon">
                            <div class="pulse-ring"></div>
                            <div class="pulse-ring delay"></div>
                            <span class="icon-inner">âœ¦</span>
                        </div>
                        <h3 data-i18n="participant.pleaseWait"></h3>
                        <p data-i18n="participant.willNotify"></p>
                    </div>

                    <!-- Ready to Draw -->
                    <div class="ready-state" id="readyState" style="display: none;">
                        <div class="status-icon ready-icon">
                            <span class="ready-crescent">â˜ª</span>
                        </div>
                        <h3 data-i18n="participant.readyToDraw"></h3>
                        <p class="ready-subtitle" data-i18n="participant.readySubtitle"></p>
                        <button onclick="drawAsParticipant()" class="draw-button">
                            <span class="draw-btn-text" data-i18n="participant.drawNow"></span>
                            <span class="draw-btn-icon">â˜ª</span>
                        </button>
                    </div>

                    <!-- Result Display -->
                    <div class="result-state" id="resultState" style="display: none;">
                        <div class="result-card">
                            <div class="result-decoration top">
                                <span>âœ¦</span>
                                <span>â˜ª</span>
                                <span>âœ¦</span>
                            </div>
                            <div class="result-name" id="participantResultDisplay"></div>
                            <div class="result-decoration bottom">
                                <span>âœ¦</span>
                                <span>â˜ª</span>
                                <span>âœ¦</span>
                            </div>
                        </div>
                        <button onclick="copyResult()" class="vintage-button copy-result-btn" data-i18n="participant.copyResult"></button>
                    </div>
                </div>

                <!-- Participants Browser -->
                <div class="participants-browser" id="participantsBrowser">
                    <div class="browser-header">
                        <span class="browser-icon">âœ¦</span>
                        <h4 data-i18n="participant.otherParticipants"></h4>
                    </div>
                    <ul id="waitingParticipantsList" class="waiting-participants-list"></ul>
                </div>
            </section>
        </div>

        <footer class="footer">
            <div class="footer-decoration">
                <span>âœ¦</span>
                <span>â˜ª</span>
                <span>âœ¦</span>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- App Scripts -->
    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
</body>
</html>
