<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุญุจ ุงูุฃุณูุงุก ุงูุณุฑู</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="ornate-border">
            <h1 class="title">ุณุญุจ ุงูุฃุณูุงุก</h1>
            <div class="role-indicator" id="roleIndicator"></div>
        </header>

        <div class="content-box ornate-border">
            <!-- Landing Page (No Session) - Participant Only -->
            <section class="landing-section" id="landingSection">
                <h2>ูุฑุญุจุงู</h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">ุฃุฏุฎู ุงุณูู ููุงูุถูุงู ุฅูู ุงูุณุญุจ</p>
                <div style="max-width: 500px; margin: 0 auto;">
                    <div class="input-group">
                        <input type="text" id="joinName" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู" class="vintage-input">
                    </div>
                    <button onclick="joinFromLanding()" class="vintage-button primary" style="width: 100%;">
                        ุงูุถู ุงูุขู
                    </button>
                </div>
            </section>

            <!-- Admin Dashboard (Session List) -->
            <section class="admin-dashboard-section" id="adminDashboardSection" style="display: none;">
                <h2>ููุญุฉ ุงููุฏูุฑ</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">ุฅุฏุงุฑุฉ ุฌูุณุงุช ุณุญุจ ุงูุฃุณูุงุก</p>

                <!-- Create New Session Button -->
                <button onclick="showCreateSession()" class="vintage-button primary" style="width: 100%; margin-bottom: 2rem;">
                    + ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ
                </button>

                <!-- Sessions List -->
                <div class="sessions-list-container">
                    <h3>ุงูุฌูุณุงุช ุงูุณุงุจูุฉ</h3>
                    <div id="sessionsListContainer">
                        <div class="empty-message">ุฌุงุฑู ุงูุชุญููู...</div>
                    </div>
                </div>
            </section>

            <!-- Create Session Modal -->
            <section class="create-session-section" id="createSessionSection" style="display: none;">
                <h2>ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ</h2>
                <div class="input-group">
                    <input type="text" id="sessionName" placeholder="ุงุณู ุงูุฌูุณุฉ (ูุซุงู: ุนุงุฆูุฉ 2026)" class="vintage-input">
                </div>
                <div class="input-group">
                    <input type="text" id="organizerName" placeholder="ุงุณูู" class="vintage-input">
                </div>
                <div class="action-buttons">
                    <button onclick="createSession()" class="vintage-button primary">
                        ุฅูุดุงุก
                    </button>
                    <button onclick="backToAdminDashboard()" class="vintage-button secondary">
                        ุฅูุบุงุก
                    </button>
                </div>
            </section>

            <!-- Organizer View -->
            <section class="organizer-section" id="organizerSection" style="display: none;">
                <div class="section-header">
                    <h2>ููุญุฉ ุงูุชุญูู</h2>
                    <button onclick="backToAdminDashboard()" class="vintage-button secondary back-btn">
                        โ ูู ุงูุฌูุณุงุช
                    </button>
                </div>

                <!-- Session Info -->
                <div class="session-info">
                    <h3 id="sessionTitle"></h3>
                    <div class="session-link-box">
                        <label>ุฑุงุจุท ุงููุดุงุฑูุฉ:</label>
                        <div class="link-display">
                            <input type="text" id="sessionLink" readonly class="link-input">
                            <button onclick="copySessionLink()" class="vintage-button">๐ ูุณุฎ</button>
                        </div>
                        <div class="share-buttons">
                            <button onclick="shareWhatsApp()" class="vintage-button">WhatsApp</button>
                            <button onclick="shareTelegram()" class="vintage-button">Telegram</button>
                        </div>
                    </div>
                    <!-- Registration Toggle -->
                    <div class="registration-toggle">
                        <button onclick="toggleRegistration()" class="vintage-button" id="registrationToggleBtn">
                            ุฅุบูุงู ุงูุชุณุฌูู
                        </button>
                        <span class="registration-status" id="registrationStatus">ุงูุชุณุฌูู ููุชูุญ</span>
                    </div>
                </div>

                <!-- Participants List -->
                <div class="participants-management">
                    <h3>ุงููุดุงุฑููู (<span id="participantCount">0</span>)</h3>
                    <!-- Add Participant Manually -->
                    <div class="add-participant-manual">
                        <input type="text" id="manualParticipantName" placeholder="ุฃุถู ูุดุงุฑู ูุฏููุงู" class="vintage-input">
                        <button onclick="addParticipantManually()" class="vintage-button">ุฅุถุงูุฉ</button>
                    </div>
                    <ul id="organizerParticipantsList" class="participants-list"></ul>
                </div>

                <!-- Restrictions Interface -->
                <div class="restrictions-section">
                    <h3>ุงููููุฏ (ุงุฎุชูุงุฑู)</h3>
                    <p class="help-text">ุญุฏุฏ ูู ูุง ูููู ุฃู ูุณุญุจ ุจุนุถูู ุจุนุถุงู</p>
                    <div id="restrictionsContainer"></div>
                </div>

                <!-- Draw Controls -->
                <div class="draw-controls">
                    <div class="draw-progress">
                        <span id="organizerProgressText">0 ูู 0 ุณุญุจูุง</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="organizerProgressFill"></div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button onclick="startDrawAsOrganizer()" class="vintage-button primary" id="startDrawBtn">
                            ุจุฏุก ุงูุณุญุจ
                        </button>
                        <button onclick="resetSession()" class="vintage-button secondary">
                            ุฅุนุงุฏุฉ ุชุนููู
                        </button>
                    </div>
                </div>

                <!-- View All Assignments (Hidden by default) -->
                <div class="view-results-section" id="viewResultsSection" style="display: none;">
                    <h3>ุนุฑุถ ุงููุชุงุฆุฌ</h3>
                    <div class="results-buttons">
                        <button onclick="showAllAssignments()" class="vintage-button" id="showResultsBtn">
                            ุนุฑุถ ุฌููุน ุงููุชุงุฆุฌ
                        </button>
                    </div>
                    <!-- Individual Results (each hidden by default) -->
                    <div class="individual-assignments" id="individualAssignmentsContainer"></div>
                    <!-- All Results View -->
                    <div class="all-assignments" id="allAssignmentsContainer" style="display: none;">
                        <div id="assignmentsList"></div>
                        <button onclick="hideAllAssignments()" class="vintage-button secondary">
                            ุฅุฎูุงุก ุงููุชุงุฆุฌ
                        </button>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="danger-zone">
                    <h3>ููุทูุฉ ุงูุฎุทุฑ</h3>
                    <button onclick="deleteSession()" class="vintage-button danger">
                        ุญุฐู ุงูุฌูุณุฉ
                    </button>
                </div>
            </section>

            <!-- Participant View -->
            <section class="participant-section" id="participantSection" style="display: none;">
                <div class="participant-name-display">
                    <span id="participantNameLabel"></span>
                </div>

                <!-- Waiting State -->
                <div class="waiting-state" id="waitingState">
                    <div class="waiting-animation">โณ</div>
                    <h3>ุฌุงุฑู ุงูุงูุชุธุงุฑ...</h3>
                    <p id="waitingMessage">ุงูููุธู ูููู ุจุฅุนุฏุงุฏ ุงูุณุญุจ</p>

                    <!-- Participants Browser -->
                    <div class="participants-browser">
                        <h4>ุงููุดุงุฑููู ุงูุขุฎุฑูู</h4>
                        <ul id="waitingParticipantsList" class="waiting-participants-list"></ul>
                    </div>
                </div>

                <!-- Excluded State -->
                <div class="excluded-state" id="excludedState" style="display: none;">
                    <div class="waiting-animation">โฐ</div>
                    <h3>ูุฑุฌู ุงูุงูุชุธุงุฑ</h3>
                    <p>ุณูุชู ุฅุนูุงูู ุนูุฏูุง ูุญูู ุฏูุฑู</p>
                </div>

                <!-- Ready to Draw -->
                <div class="ready-state" id="readyState" style="display: none;">
                    <div class="ready-animation">โจ</div>
                    <h3>ุฌุงูุฒ ููุณุญุจ!</h3>
                    <button onclick="drawAsParticipant()" class="vintage-button primary large">
                        ุงุณุญุจ ุงูุขู
                    </button>
                </div>

                <!-- Result Display -->
                <div class="result-state" id="resultState" style="display: none;">
                    <div class="result-display" id="participantResultDisplay"></div>
                    <button onclick="copyResult()" class="vintage-button">
                        ๐ค ูุณุฎ ุงููุชูุฌุฉ
                    </button>
                </div>
            </section>
        </div>

        <footer class="footer"></footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- App Scripts -->
    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
</body>
</html>
